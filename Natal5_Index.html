import streamlit as st
import pandas as pd
import os

st.set_page_config(page_title="Convite de Natal üéÑ", page_icon="üéÑ", layout="centered")

# ---- ARQUIVO CSV PARA SALVAR AS RESPOSTAS ----
CSV_PATH = "convidados.csv"

# Se o arquivo n√£o existir, cria
if not os.path.exists(CSV_PATH):
    df_init = pd.DataFrame(columns=["nome", "item", "amigo_doce"])
    df_init.to_csv(CSV_PATH, index=False)

# Fun√ß√£o para salvar
def salvar_resposta(nome, item, amigo_doce):
    df = pd.read_csv(CSV_PATH)
    df.loc[len(df)] = [nome, item, amigo_doce]
    df.to_csv(CSV_PATH, index=False)

# ---- ESTILO NATALINO ----
st.markdown("""
<style>
body {
    background: linear-gradient(180deg, #b30000, #ffffff, #006400) !important;
}
div.block-container {
    padding-top: 30px;
}
.convite {
    background: rgba(255, 248, 240, 0.95);
    padding: 25px;
    border-radius: 20px;
    border: 4px solid green;
    box-shadow: 0 0 25px rgba(0,0,0,0.4);
}
.title {
    color: darkred;
    font-size: 2.6em;
    text-shadow: 2px 2px 6px #fff;
    text-align: center;
}
.boasvindas {
    color: green;
    font-size: 1.6em;
    text-shadow: 1px 1px 3px #fff;
    text-align: center;
}
.aviso {
    color: darkred;
    font-weight: bold;
    text-align: center;
    font-size: 1.1em;
}
</style>
""", unsafe_allow_html=True)

# ---- CONTE√öDO DO SITE ----
st.markdown("<div class='convite'>", unsafe_allow_html=True)

st.markdown("<h1 class='title'>üéÑ Convite Especial de Natal üéÖ</h1>", unsafe_allow_html=True)
st.markdown("<p class='boasvindas'>‚ú® Bem vindo a Andleide ‚ú®</p>", unsafe_allow_html=True)
st.markdown("<p class='aviso'>‚ö†Ô∏è √â obrigat√≥rio participar de no m√≠nimo 1 a 2 brincadeiras!</p>", unsafe_allow_html=True)

st.write("Voc√™ est√° convidado para nossa festa de Natal! üéÅ‚ú®")
st.write("Preencha abaixo para confirmar sua presen√ßa:")

# ---- FORMUL√ÅRIO ----
with st.form("form_presenca"):
    nome = st.text_input("Seu nome")
    item = st.text_input("O que voc√™ vai levar")
    amigo_doce = st.selectbox("Vai participar do Amigo Doce?", ["Selecione", "Sim", "N√£o"])

    enviar = st.form_submit_button("Confirmar")

    if enviar:
        if nome == "" or item == "" or amigo_doce == "Selecione":
            st.error("Por favor, preencha todos os campos!")
        else:
            salvar_resposta(nome, item, amigo_doce)
            st.success("Presen√ßa confirmada com sucesso! üéÑ‚ú®")

st.markdown("</div>", unsafe_allow_html=True)

# ---- LISTA DE CONVIDADOS ----
st.markdown("## üéÅ Lista de Convidados")

df = pd.read_csv(CSV_PATH)

if len(df) == 0:
    st.info("Ainda n√£o h√° convidados confirmados.")
else:
    for i, row in df.iterrows():
        if row["amigo_doce"] == "Sim":
            st.write(f"**{row['nome']}** vai levar: **{row['item']}** + (Doce de chocolate obrigat√≥rio e R$10 para o Amigo Doce)")
        else:
            st.write(f"**{row['nome']}** vai levar: **{row['item']}**")
